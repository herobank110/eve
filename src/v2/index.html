<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Kanekanian</title>
    <script src="https://flackr.github.io/scroll-timeline/dist/scroll-timeline.js"></script>
    <link rel="prefetch" as="image" href="flipbook/flipbook_1001.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1002.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1003.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1004.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1005.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1006.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1007.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1008.png" />
    <link rel="stylesheet" href="style.scss" />
    <script>
        window.onload = () => {
            const imgs = [...document.querySelectorAll(".frameImg")];
            document.body.style.height = `calc(${imgs.length} * 100lvh)`;
            const size = imgs[0].clientHeight;
            const keyframes = [
                ...imgs.flatMap((_, i) =>
                    i == 0
                        ? Array(6).fill('0px')
                        : [
                            `-${(i - 1) * size}px`,
                            `-${(i - 1) * size}px`,
                            `-${(i - 1) * size}px`,
                            `-${Math.abs((i - 1) * size - 20)}px`,
                            `-${i * size - 10}px`,
                            `-${i * size}px`
                        ]),
            ].reverse();
            document.querySelector('.frameReel').animate(
                { top: keyframes },
                {
                    timeline: new ViewTimeline({ subject: document.body, orientation: 'block' }),
                    // timeRange: 'contain 25% 75%',
                    timeRange: 'contain',
                    fill: 'both'
                }
            )
            tickScroll();
        }

        let g_scrollVelocity = 0;
        /** @param {ScrollEvent} e */
        function onScroll(e) {
            e.preventDefault();
            g_scrollVelocity += e.deltaY;
            g_scrollVelocity *= 1.2;
        }
        window.addEventListener("mousewheel", onScroll, { passive: false })
        function tickScroll() {
            const dt = 1/60; // assume 60fps???
            const constant = 3.5;
            g_scrollVelocity *= 0.96;
            if (g_scrollVelocity < 100)
            g_scrollVelocity *= 0.98;
            if (Math.abs(g_scrollVelocity) > 1) {
                window.scrollTo(0, window.pageYOffset + g_scrollVelocity * dt * constant);
            }
            requestAnimationFrame(tickScroll);
        }
    </script>
</head>

<body>
    <div class="flipbookRoot">
        <div class="flipbookBorder">
            <div class="frameReel">
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1008.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1007.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1006.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1005.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1004.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1003.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1002.png')"></div>
                <div class="frameImg" style="background-image:url('flipbook/flipbook_1001.png')"></div>
            </div>
        </div>
    </div>

</body>

</html>